<!DOCTYPE book PUBLIC "-//OASIS//DTD DocBook V3.1//EN"[
<!ENTITY szarp-info SYSTEM "../common/szarp-info.sgml">
]>

<!--
	$Id$
 -->

<book lang="pl" id="scc">

<bookinfo>

&szarp-info;

<title>Centrum Sterowania SZARP</title>

<subtitle>SZARP wersja 3.1</subtitle>
<authorgroup>
<author><firstname>Pawe³</><surname>Pa³ucha</></author>
<author><firstname>Darek</><surname>Marcinkiewicz</></author>
</authorgroup>

<abstract>

<para>
Centrum Sterowania SZARP (SZARP Control Center, SCC) jest niewielkim
programem, który wy¶wietla menu pozwalaj±ce na uruchamianie innych programów
wchodz±cych w sk³ad systemu SZARP.
</para>
<para>
Tradycyjnie programy sk³adowe systemu SZARP by³y uruchamiane z menu menad¿era
okien. Powodowa³o to problemy przy zmianie wersji systemu czy u¿ywanego
menad¿era okien, zarówno ze wzglêdu na przyzwyczajenia u¿ytkowników, jak i
problemy z konfiguracj±. Za¶ SCC wygl±da i zachowuje siê tak samo niezale¿nie
od ¶rodowiska, w którym zosta³ uruchomiony, a poza tym jest bardzo ³atwy w
konfiguracji.
</para>
<para>
Wersja pliku: $Id$
</para>

</abstract>

</bookinfo>

<chapter id="using">
<title>Korzystanie z programu</title>

<para>
	Po uruchomieniu program widoczny jest jako ikona z bia³o-czerwonym logo
	systemu SZARP w obszarze tak zwanej <emphasis>tacki systemowej</emphasis> 
	(ang. system tray). Tacka w systemach Windows oraz w ¶rodowisku graficznym 
	KDE systemu Linux domy¶lnie znajduje siê w prawym dolnym rogu ekranu.

<figure><title>Przyk³adowy wygl±d tacki systemowej z uruchomionym Centrum Sterowania</title>
<mediaobject>
<imageobject><imagedata fileref="pics/systemtray.png"></imageobject>
</mediaobject></figure>

Obs³uga programu odbywa siê za pomoc± myszki i jest bardzo prosta:
<itemizedlist>
<listitem><para>
Klikniêcie lewym przyciskiem myszy wy¶wietla menu, z dostêpnymi programami
wchodz±cymi w sk³ad danej konfiguracji systemu SZARP, w szczególno¶ci dostêpne
s± raporty oraz program przegl±daj±cy. Wybranie pozycji z menu i klikniêcie na
niej dowolnym przyciskiem pozwala na uruchomienie wybranego programu.
</para>
<para>
	Ewentualne menu podrzêdne (zwykle zawieraj±ce raporty) otwieraj± siê po najechaniu 
	na nie wska¼nikiem myszy. Mo¿na klikn±æ na nim aby zablokowaæ je i u³atwiæ 
	wybranie pozycji z menu podrzêdnego.
<figure><title>Rozwiniête przyk³adowe menu programu Centrum Sterowania</title>
<mediaobject>
<imageobject><imagedata fileref="pics/sccmenu.png"></imageobject>
</mediaobject></figure>

</para></listitem>

<listitem><para>
		Klikniêcie na ikonie programu prawym przyciskiem myszy 
		otwiera menu konfiguracyjne programu. Dostêpne s± w nim
nastêpuj±ce opcje:
<figure><title>Menu konfiguracyjne programu Centrum Sterowania</title>
<mediaobject>
<imageobject><imagedata fileref="pics/sccconfmenu.png"></imageobject>
</mediaobject></figure>
<itemizedlist>
<listitem><para>
<emphasis>Pomoc</emphasis> - wy¶wietla okno z tekstem pomocy dla programu. Po
systemie pomocy mo¿na poruszaæ siê w sposób analogiczny jak w przegl±darce
internetowej, wybieraj±c za pomoc± wska¼nika myszki odpowiednie odno¶niki.
Na górze okna znajduj± siê przyciski, umo¿liwiaj±ce odpowiednio: zamkniêcie
okna pomocy, cofniêcie siê i przej¶cie o jedn± pozycjê w przód w historii
ogl±danych odno¶ników.
</para></listitem>

<listitem><para>
<emphasis>O programie</emphasis> - wy¶wietla okno zawieraj±ce informacjê o
wersji programu, licencji i autorach. 
</para></listitem>

<listitem><para>
<emphasis>Tunel pomocy technicznej</emphasis> - ta opcja pozwala na
zdalne zalogowanie siê z zewn±trz na komputer z uruchomionym Centrum Sterowania. 
Pozwala to na udzielenie zdalnie pomocy technicznej u¿ytkownikowi - opcji u¿ywa siê
na polecenie administratora oprogramowania SZARP.
Komunikacja odbywa siê przez
szyfrowany tunel SSH.</para>
<para> Po wybraniu opcji pojawi siê okienko, z pro¶b± o potwierdzenie
¿±dania utworzenia tunelu. W nastêpnym oknie nale¿y podaæ numer portu, na którym 
zostanie otwarty koniec tunelu na zdalnym komputerze, a tak¿e u¿ytkownika i has³o
- informacje te powinien podaæ administrator prosz±cy o otwarcie tunelu.
Przycisk <emphasis>Po³±cz</emphasis>
powoduje otwarcie tunelu. Przycisk <emphasis>Zamknij</emphasis> zamyka okno i ewentualnie
otwarty tunel. 
<figure><title>Okno tunelu pomocy technicznej</title>
<mediaobject>
<imageobject><imagedata fileref="pics/scctunel.png"></imageobject>
</mediaobject></figure>

</para></listitem>

<listitem><para>
<emphasis>Czcionki SZARP</emphasis> - wy¶wietla okienko pozwalaj±ce na wybór
domy¶lnej wielko¶ci czcionki dla wszystkich programów SZARP. Akceptacja
wybranej warto¶ci nastêpuje po klikniêciu przycisku
<guibutton>Zastosuj</guibutton>. Zmiany w wielko¶ci czcionki bêd± widoczne
tylko w nowo uruchamianych programach - np. zmiana wielko¶ci czcionki w menu
SCC bêdzie widoczna dopiero po powtórnym zalogowaniu siê. Opcja aktywna jest
tylko w wersji programu dla systemu Linux.
<note><para>Efektem dzia³ania opcji jest utworzenie w katalogu domowym
u¿ytkownika podkatalogu <filename>.szarp</filename>, a w nim
pliku <filename>gtk.rc</filename>, zawieraj±cego konfiguracjê fontów 
dla biblioteki Gtk.
</para></note>
</para></listitem>

<listitem><para>
<emphasis>Wyj¶cie</emphasis> - koñczy dzia³anie programu.
<emphasis>UWAGA!</emphasis> Po przypadkowym zamkniêciu programu mo¿na go
uruchomiæ z konsoli (poleceniem <command>/opt/szarp/bin/scc</command>) albo
przez wylogowanie i ponowne zalogowanie siê.
</para></listitem>

</itemizedlist>
</para></listitem>

</itemizedlist>
</para>

</chapter>

<chapter id="config">
<title>Konfiguracja programu</title>

<note>
<para>
Konfiguracja programu wymaga uprawnieñ administratora systemu i wiedzy na temat
konfiguracji systemu SZARP!
</para>
</note>

<para>
Program uruchamia siê komend±:
<programlisting>
/opt/szarp/bin/scc
</programlisting>
Powinien byæ uruchamiany przy starcie mened¿era okien. Mo¿na to osi±gn±æ b±d¼ w
sposób specyficzny dla danego mened¿era okien (grupa Autostart itp.), 
b±d¼ te¿ w sposób ogólny. Obecnie najlepszym sposobem jest umieszczenie 
odpowiedniego pliku w katalogu <filename>/etc/xdg/autostart</filename> (zgodnie
ze standardami FreeDesktop.org). Operacja ta jest robiona automatycznie
przy instalacji programu z pakietu.
</para>
<para>
Automatyczne uruchamianie w ¶rodowisku Windows osi±gane jest przez umieszczenie
linku do programu w folderze Autostart.
</para>
<para>
SCC pozwala na uruchomienie tylko jednej swojej kopii dla ka¿dego u¿ytkownika 
(ma to znaczenie dla serwerów, do których ³±czy siê kilka X-terminali).
</para>

<para>
	Uruchomienie programu z opcj± <option>-h</option> lub <option>--help</option>
	spowoduje wypisanie krótkiej informacji o dostêpnych opcjach.
</para>
<para>
SCC korzysta z biblioteki libparnt, a wiêc czyta opcje z pliku
<filename>/etc/szarp/szarp.cfg</filename>, przy czym jest mo¿liwo¶æ wp³ywania
na te opcje z linii komend, za pomoc± opcji typu '-Dprefix=byto'.
</para>

<para>
SCC wywo³any z opcj± <emphasis>-reload_menu</emphasis> powiadamia ju¿
dzia³aj±c± instancjê aplikacji, by ponownie wczyta³a plik konfiguracyjny
<filename>/etc/szarp/szarp.cfg</filename>. Spowoduje to zbudowanie od nowa
g³ównego menu. Program SCC wywo³any z powy¿sz± opcj± po przekazaniu komunikatu koñczy
dzia³anie.
</para>

<para>
Sekcja w pliku <filename>/etc/szarp/szarp.cfg</filename> dotycz±ca programu
nazywa siê <emphasis>scc</emphasis> i mo¿e zawieraæ nastêpuj±ce parametry:
<itemizedlist>

<listitem><para>
<emphasis>hide_aggregated</emphasis> - parametr okre¶la, czy w menu
tworzonym przez dyrektywê <emphasis>DRAWS</emphasis> nie powinny pojawiæ
siê sk³adowe konfiguracji agregowanych, je¿eli konfiguracje agregowane 
s± w menu obecne. Dopuszczalne warto¶ci parametru to <emphasis>yes</emphasis>
i <emphasis>no</emphasis>. Domy¶lnie <emphasis>yes</emphasis>.
</para></listitem>

<listitem><para>
		<emphasis>dont_aggregate</emphasis> - lista przedzielonych przecinkami 
		prefiksów konfiguracji, które nie s± traktowane jako zagregowane w
		kontek¶cie opcji <emphasis>hide_aggregated</emphasis>, czyli konfiguracje
		wchodz±ce w ich sk³ad nie bêd± ukrywane nawet przy ustawionej tej opcji.
</para></listitem>

<listitem><para>
<emphasis>update_command</emphasis> - ¶cie¿ka do komendy s³u¿±cej 
do aktualizacji danych, je¿eli plik istnieje, w menu programu SCC 
pojawi siê opcja "Aktualizuj dane", po wybraniu której uruchomiona
zostanie podana komenda.
</para></listitem>

<listitem><para>
<emphasis>su_command</emphasis> - je¿eli program SCC nie dzia³a z UID
0, przed uruchomieniem programu podanego w opcji 
<emphasis>update_command</emphasis> zostanie uruchomiony program,
którego ¶cie¿kê zawiera parametr <emphasis>su_command</emphasis>,
w celu zdobycia uprawnieñ super-u¿ytkownika.
</para></listitem>

<listitem><para>
		<emphasis>use_ekstraktor3</emphasis> - je¿eli opcja ma warto¶æ "yes", to
		w tworzonym menu dodawana jest opcja pozwalaj±ca na uruchomienie
		programu Ekstraktor.
</para></listitem>

<listitem><para>
<emphasis>menu</emphasis> - parametr opisuje zawarto¶æ g³ównego menu programu.
Opis ma postaæ listy warto¶ci oddzielonych przecinkami, bia³e znaki s±
ignorowane. Ka¿da z warto¶ci mo¿e
byæ postaci:
<itemizedlist>
<listitem><para>
<emphasis>EXEC("tytu³", "komenda")</emphasis> - tytu³ oznacza opis pozycji w
menu, po jej wybraniu wykonywana jest podana komenda.
</para></listitem>

<listitem><para>
<emphasis>DRAW("nazwa", "prefix")</emphasis> - uruchomienie programu
przegl±daj±cego z podanym prefiksem konfiguracji.
</para></listitem>

<listitem><para>
<emphasis>DRAWS("wyra¿enie_regularne")</emphasis> - generuje w miejscu wyst±pienia
listê elementów DRAW, dla konfiguracji, których prefixy pasuj± do zadanego wyra¿enia
regularnego. Nazwa tworzonych elementów DRAW to tytu³ konfiguracji. Stworzone elementy
DRAW s± pogrupowane. Grupowanie odbywa siê na podstawie tytu³ów konfiguracji, tj.
konfiguracje, których tytu³y dziel± ze sob± s³owo nie pasuj±ce do wyra¿eñ regularnych
zawartych w dyrektywie DONTGROUPBY, s± uznawane za nale¿±ce do tej samej grupy 
i zostaj± umieszczone w osobnym podmenu. Je¿eli w menu istnieje ju¿ element DRAW
odwo³uj±cy siê do danej konfiguracji, nie zostanie on przez DRAWS dodany.
</para></listitem>

<listitem><para>
<emphasis>DONTGROUPBY("wyra¿enie_regularne",...)</emphasis> - specyfikuje
listê wyra¿eñ regularnych u¿ywanych przy grupowaniu elementów DRAW generowanych 
przez dyrektywê DRAWS. Podczas dopasowywania wyra¿eñ regularnych uwzglêdniana jest
wielko¶æ liter.
</para></listitem>

<listitem><para>
<emphasis>DOC</emphasis> - tworzy pozycjê menu o nazwie "Dokumentacja SZARP",
uruchamiaj±c± program <application>wxhelp</application> wy¶wietlaj±cy
dokumentacjê SZARP'a.
</para></listitem>

<listitem><para>
<emphasis>ICON("ikona")</emphasis> - dodanie do poprzedniej pozycji menu 
ikony (obrazka), ³adowanego z pliku o podanej
¶cie¿ce. Ikona mo¿e byæ w dowolnym formacie obs³ugiwanym przez bibliotekê
wxWindows, w praktyce powinien to byæ plik typu 'XPM', z ikon± o wielko¶ci 16
na 16 punktów, z palet± 3 bajtow± (opisy kolorów bez przezroczysto¶ci).
</para></listitem>

<listitem><para>
<emphasis>MENU("nazwa", ...)</emphasis> - wstawia menu podrzêdne o podanej
nazwie, zawieraj±ce elementy z podanej po nazwie listy elementów.
</para></listitem>

<listitem><para>
<emphasis>CONFIG("prefix")</emphasis> - jest równowa¿ny li¶cie elementów,
zawieraj±cych wszystkie raporty oraz program przegl±daj±cy dla konfiguracji o
danym prefiksie. Informacja o strukturze raportów jest wczytywana
automatycznie pod warunkiem, ¿e konfiguracja jest zgodna z formatem IPK. Je¿eli
w katalogu <filename>config</filename> konfiguracji istnieje plik
<filename>params.xml</filename>, to zostan± odczytane informacje z niego.
Je¿eli nie, to podjêta bêdzie próba odczytania konfiguracji z plików w formacie
SZARP 2.1.
</para></listitem>

<listitem><para>
<emphasis>SEPARATOR</emphasis> - pozioma linia oddzielaj±ca pozycje menu.
</para></listitem>

</itemizedlist>
</para></listitem>
</itemizedlist>
Wielko¶æ liter w nazwach elementów nie ma znaczenia.
</para>
<para>
Jak zaznaczono w powy¿szym opisie, wszystkie ci±gi tekstowe podawane jako
parametry musz± byæ w podwójnych cudzys³owach. Znak '\' jest znakiem
specjalnym, kolejny znak po nim jest bezwzglêdnie traktowany jak czê¶æ napisu,
wobec tego mo¿na u¿yæ cudzys³owu przez '\"', za¶ sam backslash wstawimy przez
'\\'.
</para>
<para>
Dla u³atwienia wykrywania b³êdów program wypisuje na standardowe wyj¶cie
wykonywane komendy, wobec tego mo¿na uruchomiæ go w terminalu i obserwowaæ,
jakie komendy s± wywo³ywane.
</para>
<para>
Domy¶ln± warto¶æ parametru <emphasis>menu</emphasis> jest nastêpuj±ca:
<programlisting>
menu = CONFIG("$prefix$"), SEPARATOR, DOC, \
	ICON("/opt/szarp/resources/wx/icons/praterm16.xpm")
</programlisting>
Tak wiêc, o ile konfiguracja jest zgodna z IPK, nie podanie ¿adnej warto¶ci
powoduje stworzenie menu z wszystkimi raportami i programem przegl±daj±cym dla
konfiguracji (oraz dokumentacj± SZARP).
</para>

<para>
Przyk³adowa konfiguracja mo¿e wygl±daæ tak:
<programlisting>
<![CDATA[
:scc
animate=yes
menu= 	CONFIG("kato"), \
	EXEC("Dyspozytor", "/opt/szarp/bin/dyspwx \
		-Dprefix=kato /opt/szarp/kato/config/t.dsc"), \
	ICON("/opt/szarp/resources/wx/icons/dysp16.xpm"), \
	SEPARATOR, \
	MENU("Inne ciep³ownie", \
		DRAW("Bytów", "byto"), \
		ICON("/opt/szarp/resources/wx/icons/draw16.xpm"), \
		DRAW("¦widnik", "swid"), \
		ICON("/opt/szarp/resources/wx/icons/draw16.xpm"), \
		DRAWS(".*") \
	), \
	SEPARATOR, \
	DOC, \
	ICON("/opt/szarp/resources/wx/icons/praterm16.xpm"), \
	DONTGROUPBY("Ciep³ownia", "Wêze³", ".*EC$")

]]>
</programlisting>
</para>
</chapter>

</book>


